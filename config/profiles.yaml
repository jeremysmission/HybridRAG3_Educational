# ============================================================================
# HybridRAG v3 — Performance Profiles
# ============================================================================
# Location: config/profiles.yaml
#
# These profiles override settings in default_config.yaml based on your
# machine's hardware. The system_diagnostic.py script auto-detects your
# hardware and recommends one of these profiles.
#
# HOW TO USE:
#   1. Run: python -m src.tools.system_diagnostic
#      This detects hardware and writes recommendation to system_profile.json
#
#   2. Set the profile in start_hybridrag.ps1:
#      $env:HYBRIDRAG_PROFILE = "laptop_safe"    # or desktop_power, server_max
#
#   3. Or switch via the GUI engineering menu (future feature)
#
# PROFILE SELECTION CRITERIA:
#   laptop_safe   — RAM ≤ 16GB (any CPU)
#   desktop_power — RAM 32-64GB, 8+ cores
#   server_max    — RAM 64GB+, 16+ cores
#
# The main bottleneck for RAG is RAM, not CPU. The embedding model uses
# ~100MB, but working set (chunks + embeddings in memory) grows with
# batch size. Larger batches = faster indexing but more RAM.
# ============================================================================

# --- LAPTOP SAFE ---
# For: HP Spectre, Surface Pro, MacBook Air, any 8-16GB laptop
# Priority: Stability over speed. Never risk swapping to disk.
# Batch size 16 keeps peak RAM under 2GB during indexing.
laptop_safe:
  embedding:
    batch_size: 16               # Small batches = low RAM, slower indexing
    device: "cpu"                # No GPU assumed
  chunking:
    chunk_size: 1200             # Standard chunk size
    overlap: 200                 # Standard overlap
  retrieval:
    top_k: 5                    # Fewer results = faster query
    reranker_top_n: 20          # Fewer candidates to rerank
  indexing:
    block_chars: 200000          # 200K chars per block (RAM-safe)
    max_chars_per_file: 2000000  # 2M char limit per file
  performance:
    max_concurrent_files: 1      # Process one file at a time
    gc_between_files: true       # Force garbage collection between files
    gc_between_blocks: true      # Force GC between blocks within a file
  notes: >
    Conservative settings for laptops with 8-16GB RAM.
    Indexing is slower but rock-solid stable. No risk of
    memory pressure causing Windows to swap or crash.

# --- DESKTOP POWER ---
# For: Engineering workstations, gaming PCs, 32-64GB machines
# Priority: Throughput. Larger batches, less GC overhead.
# Batch size 64 uses ~4GB peak RAM during indexing.
desktop_power:
  embedding:
    batch_size: 64               # 4x laptop = 4x faster embedding
    device: "cpu"                # Change to "cuda" if GPU available
  chunking:
    chunk_size: 1200
    overlap: 200
  retrieval:
    top_k: 10                   # More results = better recall
    reranker_top_n: 40          # More candidates = better precision
  indexing:
    block_chars: 500000          # 500K chars per block
    max_chars_per_file: 5000000  # 5M char limit
  performance:
    max_concurrent_files: 2      # Process 2 files in parallel (future)
    gc_between_files: false      # Skip GC — plenty of RAM
    gc_between_blocks: false
  notes: >
    Aggressive settings for desktops with 32-64GB RAM.
    4x faster embedding than laptop_safe. Suitable for
    overnight indexing of large corpora (10GB+).

# --- SERVER MAX ---
# For: Rack servers, cloud instances, 64GB+ workstations
# Priority: Maximum throughput. Use all available resources.
# Batch size 128 uses ~8GB peak RAM during indexing.
server_max:
  embedding:
    batch_size: 128              # 8x laptop = maximum throughput
    device: "cpu"                # Change to "cuda" for GPU
  chunking:
    chunk_size: 1200
    overlap: 200
  retrieval:
    top_k: 15                   # Maximum recall
    reranker_top_n: 60          # Maximum precision
  indexing:
    block_chars: 1000000         # 1M chars per block
    max_chars_per_file: 10000000 # 10M char limit
  performance:
    max_concurrent_files: 4      # Process 4 files in parallel (future)
    gc_between_files: false
    gc_between_blocks: false
  notes: >
    Maximum settings for servers or high-end workstations.
    8x faster than laptop_safe. Requires 64GB+ RAM.
    Suitable for indexing entire document libraries (100GB+).
